From 5a1c4ff184475203857b47ebcd5a074a402d8542 Mon Sep 17 00:00:00 2001
From: Yongqin Liu <yongqin.liu@linaro.org>
Date: Sun, 30 Sep 2018 16:33:30 +0800
Subject: [PATCH 5/7] enable wifi by default

Signed-off-by: Yongqin Liu <yongqin.liu@linaro.org>
---
 network.txt                                        | 4 +++-
 package/kernel/mac80211/files/lib/wifi/mac80211.sh | 7 +++++--
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/network.txt b/network.txt
index 3767fce306..da576da5d5 100755
--- a/network.txt
+++ b/network.txt
@@ -62,6 +62,8 @@ sudo apt-get install -y build-essential asciidoc binutils bzip2 gawk gettext  gi
 # WiFi /etc/config/wireless
 # https://openwrt.org/docs/guide-user/network/wifi/basic
 # https://wiki.openwrt.org/doc/uci/wireless
+# https://datahunter.org/openwrt_networking
+# https://wiki.openwrt.org/doc/uci/network
 
 config wifi-device 'radio0'
     option type 'mac80211'
@@ -483,7 +485,7 @@ lrwxrwxrwx    1 root     root             0 Sep 28 17:07 eth1.1 -> ../../devices
 lrwxrwxrwx    1 root     root             0 Jan  1  1970 lo -> ../../devices/virtual/net/lo/
 lrwxrwxrwx    1 root     root             0 Sep 28 17:28 wlan0 -> ../../devices/platform/ar933x_wmac/net/wlan0/
 root@OpenWrt:/#
-=========================
+===============================
 kernel version decided in file include/kernel.mk and with script ./scripts/get_source_date_epoch.sh
 
 =====================
diff --git a/package/kernel/mac80211/files/lib/wifi/mac80211.sh b/package/kernel/mac80211/files/lib/wifi/mac80211.sh
index 511a9188db..cb7250aa6d 100644
--- a/package/kernel/mac80211/files/lib/wifi/mac80211.sh
+++ b/package/kernel/mac80211/files/lib/wifi/mac80211.sh
@@ -106,6 +106,7 @@ detect_mac80211() {
 			dev_id="set wireless.radio${devidx}.macaddr=$(cat /sys/class/ieee80211/${dev}/macaddress)"
 		fi
 
+		#https://openwrt.org/docs/guide-user/network/wifi/encryption
 		uci -q batch <<-EOF
 			set wireless.radio${devidx}=wifi-device
 			set wireless.radio${devidx}.type=mac80211
@@ -113,14 +114,16 @@ detect_mac80211() {
 			set wireless.radio${devidx}.hwmode=11${mode_band}
 			${dev_id}
 			${ht_capab}
-			set wireless.radio${devidx}.disabled=1
+			set wireless.radio${devidx}.disabled=0
 
 			set wireless.default_radio${devidx}=wifi-iface
 			set wireless.default_radio${devidx}.device=radio${devidx}
 			set wireless.default_radio${devidx}.network=lan
 			set wireless.default_radio${devidx}.mode=ap
 			set wireless.default_radio${devidx}.ssid=OpenWrt
-			set wireless.default_radio${devidx}.encryption=none
+			#set wireless.default_radio${devidx}.encryption=none
+			set wireless.default_radio${devidx}.encryption=psk
+			set wireless.default_radio${devidx}.key=12345678
 EOF
 		uci -q commit wireless
 
-- 
2.20.1

