# https://openwrt.org/docs/start
# could be used to check all possible functions

How to select a tag to base:

check if there release for the tag like
    http://downloads.openwrt.org/releases/18.06.7/targets/ar71xx/tiny/packages/Packages.gz
18.06.7 is the tag to be used

https://openwrt.org/supported_devices/432_warning
https://openwrt.org/docs/guide-user/additional-software/imagebuilder
https://openwrt.org/docs/guide-user/additional-software/saving_space
https://openwrt.org/docs/guide-user/additional-software/extroot_configuration

# usb drive would be recognized as /dev/sdxx sd mean scsi disk
# in dmesg following lines would be printed:
[    6.964113] usb-storage 1-1:1.0: USB Mass Storage device detected
[    6.970400] scsi host0: usb-storage 1-1:1.0
[    8.007425] scsi 0:0:0:0: Direct-Access              Flash Disk       2.00 PQ: 0 ANSI: 2
[    8.017759] sd 0:0:0:0: [sda] 516608 512-byte logical blocks: (265 MB/252 MiB)
[    8.024174] sd 0:0:0:0: [sda] Write Protect is off
[    8.028394] sd 0:0:0:0: [sda] Mode Sense: 0b 00 00 08
[    8.028917] sd 0:0:0:0: [sda] No Caching mode page found
[    8.033630] sd 0:0:0:0: [sda] Assuming drive cache: write through
[    8.048292] sd 0:0:0:0: [sda] Attached SCSI removable disk

# checking filesystems supported:
root@OpenWrt:/# cat /proc/filesystems
nodev   sysfs
nodev   rootfs
nodev   ramfs
nodev   bdev
nodev   proc
nodev   tmpfs
nodev   debugfs
nodev   sockfs
nodev   bpf
nodev   pipefs
nodev   devpts
        squashfs
nodev   jffs2
nodev   overlay
        vfat
root@OpenWrt:/#

## to boot with usb drive
## 1. compile the images with block-mount, kmod-fs-ext4, kmod-usb-core, kmod-usb-storag enabled
##    so that the usb drive could be recognized.
## 2. disable ipv6 support, so that we could create the images for 4MB devices
## 3. boot and change it to boot from usb drive:
##    https://openwrt.org/docs/guide-user/additional-software/extroot_configuration
##
## 3.1 backup the old overlay
        DEVICE="$(awk -e '/\s\/overlay\s/{print $1}' /etc/mtab)"
        uci -q delete fstab.rwm
        uci set fstab.rwm="mount"
        uci set fstab.rwm.device="${DEVICE}"
        uci set fstab.rwm.target="/rwm"
        uci commit fstab
## 3.2 add new config to mount usb drive
        DEVICE="/dev/sda1"
        eval $(block info "${DEVICE}" | grep -o -e "UUID=\S*")
        uci -q delete fstab.overlay
        uci set fstab.overlay="mount"
        uci set fstab.overlay.uuid="${UUID}"
        uci set fstab.overlay.target="/overlay"
        uci commit fstab
## 3.3 copy data to usb drive
        mount /dev/sda1 /mnt
        cp -a -f /overlay/. /mnt
        umount /mnt
## 3.4 reboot
## 3.5 make swap partition
        dd if=/dev/zero of=/swap bs=1M count=100
        mkswap /swap

        uci -q delete fstab.swap
        uci set fstab.swap="swap"
        uci set fstab.swap.device="/swap"
        uci commit fstab
        /etc/init.d/fstab boot
## 3.4 reboot to boot from usb

## 4  Install Luci
## 4.1 install Luci
        opkg update
        opkg install luci

## F.1 support for usb video
    https://openwrt.org/docs/guide-user/hardware/video/usb.video
    https://openwrt.org/docs/guide-user/hardware/video/webcam

    opkg install kmod-video-uvc mjpg-streamer
    /etc/init.d/mjpg-streamer enable
    /etc/init.d/mjpg-streamer start

    Now open the URL http://192.168.1.1:8080/ in the Firefox browser or VLC and watch the MJPEG stream (the default username/password is “openwrt”/“openwrt”).
    In other browsers, scripts, etc., you can use http://192.168.1.1:8080?action=snapshot for taking one image or http://192.168.1.1:8080?action=stream for stream of images.

## F.2 support for usb printer
    https://openwrt.org/docs/guide-user/services/print_server/cups.server

## P.1 Cannot satisfy the following dependencies for kmod-video-uvc:

        root@OpenWrt:/# opkg install kmod-video-uvc
        Installing kmod-video-uvc (4.9.211-1) to root...
        Downloading http://downloads.openwrt.org/releases/18.06-SNAPSHOT/targets/ar71xx/tiny/packages/kmod-video-uvc_4.9.211-1_mips_24kc.ipk
        Collected errors:
         * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-video-uvc:
         *      kernel (= 4.9.211-1-db2d5425c674d1648616e3c37760e80e)
         * opkg_install_cmd: Cannot install package kmod-video-uvc.
        root@OpenWrt:/# cat /proc/version
        Linux version 4.9.208 (liuyq@laptop) (gcc version 7.3.0 (OpenWrt GCC 7.3.0 r7960+9-ab9d1bf608) ) #0 Mon Jan 13 10:01:11 2020
        root@OpenWrt:/#

        root@OpenWrt:/# opkg info kmod-video-uvc
        Package: kmod-video-uvc
        Version: 4.9.211-1
        Depends: kernel (= 4.9.211-1-db2d5425c674d1648616e3c37760e80e), kmod-usb-core, kmod-video-videobuf2, kmod-input-core, kmod-video-core
        Status: install user not-installed
        Section: kernel
        Architecture: mips_24kc
        Size: 38549
        Filename: kmod-video-uvc_4.9.211-1_mips_24kc.ipk
        Description: Kernel modules for supporting USB Video Class (UVC) devices
        root@OpenWrt:/#

    Resolution 1:
        opkg install kmod-video-uvc --force-depends
    Resolution 2:
        KERNEL_PATCHVER defined in include/kernel-version.mk
        update urls defined in /etc/opkg/distfeeds.conf, like
            root@OpenWrt:/# cat /etc/opkg/distfeeds.conf
            src/gz openwrt_core http://downloads.openwrt.org/releases/18.06.6/targets/ar71xx/tiny/packages
            src/gz openwrt_base http://downloads.openwrt.org/releases/18.06.6/packages/mips_24kc/base
            src/gz openwrt_luci http://downloads.openwrt.org/releases/18.06.6/packages/mips_24kc/luci
            src/gz openwrt_packages http://downloads.openwrt.org/releases/18.06.6/packages/mips_24kc/packages
            src/gz openwrt_routing http://downloads.openwrt.org/releases/18.06.6/packages/mips_24kc/routing
            src/gz openwrt_telephony http://downloads.openwrt.org/releases/18.06.6/packages/mips_24kc/telephony
            root@OpenWrt:/#


